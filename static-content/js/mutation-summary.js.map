{"version":3,"file":"mutation-summary.js","sourceRoot":"","sources":["../src/mutation-summary.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2011 Google Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\ndeclare var WebKitMutationObserver: MutationObserver;\n\nvar MutationObserverCtor;\nif (typeof WebKitMutationObserver !== 'undefined')\n  MutationObserverCtor = WebKitMutationObserver;\nelse\n  MutationObserverCtor = MutationObserver;\n\nif (MutationObserverCtor === undefined) {\n  console.error('DOM Mutation Observers are required.');\n  console.error('https://developer.mozilla.org/en-US/docs/DOM/MutationObserver');\n  throw Error('DOM Mutation Observers are required');\n}\n\ninterface StringMap<T> {\n  [key: string]: T;\n}\n\ninterface NumberMap<T> {\n  [key: number]: T;\n}\n\nclass NodeMap<T> {\n\n  private static ID_PROP = '__mutation_summary_node_map_id__';\n  private static nextId_:number = 1;\n\n  private nodes:Node[];\n  private values:T[];\n\n  constructor() {\n    this.nodes = [];\n    this.values = [];\n  }\n\n  private isIndex(s:string):boolean {\n    return +s === <any>s >>> 0;\n  }\n\n  private nodeId(node:Node) {\n    var id = node[NodeMap.ID_PROP];\n    if (!id)\n      id = node[NodeMap.ID_PROP] = NodeMap.nextId_++;\n    return id;\n  }\n\n  set(node:Node, value:T) {\n    var id = this.nodeId(node);\n    this.nodes[id] = node;\n    this.values[id] = value;\n  }\n\n  get(node:Node):T {\n    var id = this.nodeId(node);\n    return this.values[id];\n  }\n\n  has(node:Node):boolean {\n    return this.nodeId(node) in this.nodes;\n  }\n\n  delete(node:Node) {\n    var id = this.nodeId(node);\n    delete this.nodes[id];\n    this.values[id] = undefined;\n  }\n\n  keys():Node[] {\n    var nodes:Node[] = [];\n    for (var id in this.nodes) {\n      if (!this.isIndex(id))\n        continue;\n      nodes.push(this.nodes[id]);\n    }\n\n    return nodes;\n  }\n}\n\n/**\n *  var reachableMatchableProduct = [\n *  //  STAYED_OUT,  ENTERED,     STAYED_IN,   EXITED\n *    [ STAYED_OUT,  STAYED_OUT,  STAYED_OUT,  STAYED_OUT ], // STAYED_OUT\n *    [ STAYED_OUT,  ENTERED,     ENTERED,     STAYED_OUT ], // ENTERED\n *    [ STAYED_OUT,  ENTERED,     STAYED_IN,   EXITED     ], // STAYED_IN\n *    [ STAYED_OUT,  STAYED_OUT,  EXITED,      EXITED     ]  // EXITED\n *  ];\n */\n\nenum Movement {\n  STAYED_OUT,\n  ENTERED,\n  STAYED_IN,\n  REPARENTED,\n  REORDERED,\n  EXITED\n}\n\nfunction enteredOrExited(changeType:Movement):boolean {\n  return changeType === Movement.ENTERED || changeType === Movement.EXITED;\n}\n\nclass NodeChange {\n\n  public isCaseInsensitive:boolean;\n\n  constructor(public node:Node,\n              public childList:boolean = false,\n              public attributes:boolean = false,\n              public characterData:boolean = false,\n              public oldParentNode:Node = null,\n              public added:boolean = false,\n              private attributeOldValues:StringMap<string> = null,\n              public characterDataOldValue:string = null) {\n    this.isCaseInsensitive =\n        this.node.nodeType === Node.ELEMENT_NODE &&\n        this.node instanceof HTMLElement &&\n        this.node.ownerDocument instanceof HTMLDocument;\n  }\n\n  getAttributeOldValue(name:string):string {\n    if (!this.attributeOldValues)\n      return undefined;\n    if (this.isCaseInsensitive)\n      name = name.toLowerCase();\n    return this.attributeOldValues[name];\n  }\n\n  getAttributeNamesMutated():string[] {\n    var names:string[] = [];\n    if (!this.attributeOldValues)\n      return names;\n    for (var name in this.attributeOldValues) {\n      names.push(name);\n    }\n    return names;\n  }\n\n  attributeMutated(name:string, oldValue:string) {\n    this.attributes = true;\n    this.attributeOldValues = this.attributeOldValues || {};\n\n    if (name in this.attributeOldValues)\n      return;\n\n    this.attributeOldValues[name] = oldValue;\n  }\n\n  characterDataMutated(oldValue:string) {\n    if (this.characterData)\n      return;\n    this.characterData = true;\n    this.characterDataOldValue = oldValue;\n  }\n\n  // Note: is it possible to receive a removal followed by a removal. This\n  // can occur if the removed node is added to an non-observed node, that\n  // node is added to the observed area, and then the node removed from\n  // it.\n  removedFromParent(parent:Node) {\n    this.childList = true;\n    if (this.added || this.oldParentNode)\n      this.added = false;\n    else\n      this.oldParentNode = parent;\n  }\n\n  insertedIntoParent() {\n    this.childList = true;\n    this.added = true;\n  }\n\n  // An node's oldParent is\n  //   -its present parent, if its parentNode was not changed.\n  //   -null if the first thing that happened to it was an add.\n  //   -the node it was removed from if the first thing that happened to it\n  //      was a remove.\n  getOldParent() {\n    if (this.childList) {\n      if (this.oldParentNode)\n        return this.oldParentNode;\n      if (this.added)\n        return null;\n    }\n\n    return this.node.parentNode;\n  }\n}\n\nclass ChildListChange {\n\n  public added:NodeMap<boolean>;\n  public removed:NodeMap<boolean>;\n  public maybeMoved:NodeMap<boolean>;\n  public oldPrevious:NodeMap<Node>;\n  public moved:NodeMap<boolean>;\n\n  constructor() {\n    this.added = new NodeMap<boolean>();\n    this.removed = new NodeMap<boolean>();\n    this.maybeMoved = new NodeMap<boolean>();\n    this.oldPrevious = new NodeMap<Node>();\n    this.moved = undefined;\n  }\n}\n\nclass TreeChanges extends NodeMap<NodeChange> {\n\n  public anyParentsChanged:boolean;\n  public anyAttributesChanged:boolean;\n  public anyCharacterDataChanged:boolean;\n\n  private reachableCache:NodeMap<boolean>;\n  private wasReachableCache:NodeMap<boolean>;\n\n  private rootNode:Node;\n\n  constructor(rootNode:Node, mutations:MutationRecord[]) {\n    super();\n\n    this.rootNode = rootNode;\n    this.reachableCache = undefined;\n    this.wasReachableCache = undefined;\n    this.anyParentsChanged = false;\n    this.anyAttributesChanged = false;\n    this.anyCharacterDataChanged = false;\n\n    for (var m = 0; m < mutations.length; m++) {\n      var mutation = mutations[m];\n      switch (mutation.type) {\n\n        case 'childList':\n          this.anyParentsChanged = true;\n          for (var i = 0; i < mutation.removedNodes.length; i++) {\n            var node = mutation.removedNodes[i];\n            this.getChange(node).removedFromParent(mutation.target);\n          }\n          for (var i = 0; i < mutation.addedNodes.length; i++) {\n            var node = mutation.addedNodes[i];\n            this.getChange(node).insertedIntoParent();\n          }\n          break;\n\n        case 'attributes':\n          this.anyAttributesChanged = true;\n          var change = this.getChange(mutation.target);\n          change.attributeMutated(mutation.attributeName, mutation.oldValue);\n          break;\n\n        case 'characterData':\n          this.anyCharacterDataChanged = true;\n          var change = this.getChange(mutation.target);\n          change.characterDataMutated(mutation.oldValue);\n          break;\n      }\n    }\n  }\n\n  getChange(node:Node):NodeChange {\n    var change = this.get(node);\n    if (!change) {\n      change = new NodeChange(node);\n      this.set(node, change);\n    }\n    return change;\n  }\n\n  getOldParent(node:Node):Node {\n    var change = this.get(node);\n    return change ? change.getOldParent() : node.parentNode;\n  }\n\n  getIsReachable(node:Node):boolean {\n    if (node === this.rootNode)\n      return true;\n    if (!node)\n      return false;\n\n    this.reachableCache = this.reachableCache || new NodeMap<boolean>();\n    var isReachable = this.reachableCache.get(node);\n    if (isReachable === undefined) {\n      isReachable = this.getIsReachable(node.parentNode);\n      this.reachableCache.set(node, isReachable);\n    }\n    return isReachable;\n  }\n\n  // A node wasReachable if its oldParent wasReachable.\n  getWasReachable(node:Node):boolean {\n    if (node === this.rootNode)\n      return true;\n    if (!node)\n      return false;\n\n    this.wasReachableCache = this.wasReachableCache || new NodeMap<boolean>();\n    var wasReachable:boolean = this.wasReachableCache.get(node);\n    if (wasReachable === undefined) {\n      wasReachable = this.getWasReachable(this.getOldParent(node));\n      this.wasReachableCache.set(node, wasReachable);\n    }\n    return wasReachable;\n  }\n\n  reachabilityChange(node:Node):Movement {\n    if (this.getIsReachable(node)) {\n      return this.getWasReachable(node) ?\n        Movement.STAYED_IN : Movement.ENTERED;\n    }\n\n    return this.getWasReachable(node) ?\n      Movement.EXITED : Movement.STAYED_OUT;\n  }\n}\n\nclass MutationProjection {\n\n  private treeChanges:TreeChanges;\n  private entered:Node[];\n  private exited:Node[];\n  private stayedIn:NodeMap<Movement>;\n  private visited:NodeMap<boolean>;\n  private childListChangeMap:NodeMap<ChildListChange>;\n  private characterDataOnly:boolean;\n  private matchCache:NumberMap<NodeMap<Movement>>;\n\n  // TOOD(any)\n  constructor(public rootNode:Node,\n              public mutations:MutationRecord[],\n              public selectors:Selector[],\n              public calcReordered:boolean,\n              public calcOldPreviousSibling:boolean) {\n\n    this.treeChanges = new TreeChanges(rootNode, mutations);\n    this.entered = [];\n    this.exited = [];\n    this.stayedIn = new NodeMap<Movement>();\n    this.visited = new NodeMap<boolean>();\n    this.childListChangeMap = undefined;\n    this.characterDataOnly = undefined;\n    this.matchCache = undefined;\n\n    this.processMutations();\n  }\n\n  processMutations() {\n    if (!this.treeChanges.anyParentsChanged &&\n        !this.treeChanges.anyAttributesChanged)\n      return;\n\n    var changedNodes:Node[] = this.treeChanges.keys();\n    for (var i = 0; i < changedNodes.length; i++) {\n      this.visitNode(changedNodes[i], undefined);\n    }\n  }\n\n  visitNode(node:Node, parentReachable:Movement) {\n    if (this.visited.has(node))\n      return;\n\n    this.visited.set(node, true);\n\n    var change = this.treeChanges.get(node);\n    var reachable = parentReachable;\n\n    // node inherits its parent's reachability change unless\n    // its parentNode was mutated.\n    if ((change && change.childList) || reachable == undefined)\n      reachable = this.treeChanges.reachabilityChange(node);\n\n    if (reachable === Movement.STAYED_OUT)\n      return;\n\n    // Cache match results for sub-patterns.\n    this.matchabilityChange(node);\n\n    if (reachable === Movement.ENTERED) {\n      this.entered.push(node);\n    } else if (reachable === Movement.EXITED) {\n      this.exited.push(node);\n      this.ensureHasOldPreviousSiblingIfNeeded(node);\n\n    } else if (reachable === Movement.STAYED_IN) {\n      var movement = Movement.STAYED_IN;\n\n      if (change && change.childList) {\n        if (change.oldParentNode !== node.parentNode) {\n          movement = Movement.REPARENTED;\n          this.ensureHasOldPreviousSiblingIfNeeded(node);\n        } else if (this.calcReordered && this.wasReordered(node)) {\n          movement = Movement.REORDERED;\n        }\n      }\n\n      this.stayedIn.set(node, movement);\n    }\n\n    if (reachable === Movement.STAYED_IN)\n      return;\n\n    // reachable === ENTERED || reachable === EXITED.\n    for (var child = node.firstChild; child; child = child.nextSibling) {\n      this.visitNode(child, reachable);\n    }\n  }\n\n  ensureHasOldPreviousSiblingIfNeeded(node:Node) {\n    if (!this.calcOldPreviousSibling)\n      return;\n\n    this.processChildlistChanges();\n\n    var parentNode = node.parentNode as Node;\n    var nodeChange = this.treeChanges.get(node);\n    if (nodeChange && nodeChange.oldParentNode)\n      parentNode = nodeChange.oldParentNode;\n\n    var change = this.childListChangeMap.get(parentNode);\n    if (!change) {\n      change = new ChildListChange();\n      this.childListChangeMap.set(parentNode, change);\n    }\n\n    if (!change.oldPrevious.has(node)) {\n      change.oldPrevious.set(node, node.previousSibling);\n    }\n  }\n\n  getChanged(summary:Summary, selectors:Selector[], characterDataOnly:boolean) {\n    this.selectors = selectors;\n    this.characterDataOnly = characterDataOnly;\n\n    for (var i = 0; i < this.entered.length; i++) {\n      var node = this.entered[i];\n      var matchable = this.matchabilityChange(node);\n      if (matchable === Movement.ENTERED || matchable === Movement.STAYED_IN)\n        summary.added.push(node);\n    }\n\n    var stayedInNodes = this.stayedIn.keys();\n    for (var i = 0; i < stayedInNodes.length; i++) {\n      var node = stayedInNodes[i];\n      var matchable = this.matchabilityChange(node);\n\n      if (matchable === Movement.ENTERED) {\n        summary.added.push(node);\n      } else if (matchable === Movement.EXITED) {\n        summary.removed.push(node);\n      } else if (matchable === Movement.STAYED_IN && (summary.reparented || summary.reordered)) {\n        var movement:Movement = this.stayedIn.get(node);\n        if (summary.reparented && movement === Movement.REPARENTED)\n          summary.reparented.push(node);\n        else if (summary.reordered && movement === Movement.REORDERED)\n          summary.reordered.push(node);\n      }\n    }\n\n    for (var i = 0; i < this.exited.length; i++) {\n      var node = this.exited[i];\n      var matchable = this.matchabilityChange(node);\n      if (matchable === Movement.EXITED || matchable === Movement.STAYED_IN)\n        summary.removed.push(node);\n    }\n  }\n\n  getOldParentNode(node:Node):Node {\n    var change = this.treeChanges.get(node);\n    if (change && change.childList)\n      return change.oldParentNode ? change.oldParentNode : null;\n\n    var reachabilityChange = this.treeChanges.reachabilityChange(node);\n    if (reachabilityChange === Movement.STAYED_OUT || reachabilityChange === Movement.ENTERED)\n      throw Error('getOldParentNode requested on invalid node.');\n\n    return node.parentNode;\n  }\n\n  getOldPreviousSibling(node:Node):Node {\n    var parentNode = node.parentNode as Node;\n    var nodeChange = this.treeChanges.get(node);\n    if (nodeChange && nodeChange.oldParentNode)\n      parentNode = nodeChange.oldParentNode;\n\n    var change = this.childListChangeMap.get(parentNode);\n    if (!change)\n      throw Error('getOldPreviousSibling requested on invalid node.');\n\n    return change.oldPrevious.get(node);\n  }\n\n  getOldAttribute(element:Node, attrName:string):string {\n    var change = this.treeChanges.get(element);\n    if (!change || !change.attributes)\n      throw Error('getOldAttribute requested on invalid node.');\n\n    var value = change.getAttributeOldValue(attrName);\n    if (value === undefined)\n      throw Error('getOldAttribute requested for unchanged attribute name.');\n\n    return value;\n  }\n\n  attributeChangedNodes(includeAttributes:string[]):StringMap<Element[]> {\n    if (!this.treeChanges.anyAttributesChanged)\n      return {}; // No attributes mutations occurred.\n\n    var attributeFilter:StringMap<boolean>;\n    var caseInsensitiveFilter:StringMap<string>;\n    if (includeAttributes) {\n      attributeFilter = {};\n      caseInsensitiveFilter = {};\n      for (var i = 0; i < includeAttributes.length; i++) {\n        var attrName:string = includeAttributes[i];\n        attributeFilter[attrName] = true;\n        caseInsensitiveFilter[attrName.toLowerCase()] = attrName;\n      }\n    }\n\n    var result:StringMap<Element[]> = {};\n    var nodes = this.treeChanges.keys();\n\n    for (var i = 0; i < nodes.length; i++) {\n      var node = nodes[i];\n\n      var change = this.treeChanges.get(node);\n      if (!change.attributes)\n        continue;\n\n      if (Movement.STAYED_IN !== this.treeChanges.reachabilityChange(node) ||\n          Movement.STAYED_IN !== this.matchabilityChange(node)) {\n        continue;\n      }\n\n      var element = <Element>node;\n      var changedAttrNames = change.getAttributeNamesMutated();\n      for (var j = 0; j < changedAttrNames.length; j++) {\n        var attrName = changedAttrNames[j];\n\n        if (attributeFilter &&\n            !attributeFilter[attrName] &&\n            !(change.isCaseInsensitive && caseInsensitiveFilter[attrName])) {\n          continue;\n        }\n\n        var oldValue = change.getAttributeOldValue(attrName);\n        if (oldValue === element.getAttribute(attrName))\n          continue;\n\n        if (caseInsensitiveFilter && change.isCaseInsensitive)\n          attrName = caseInsensitiveFilter[attrName];\n\n        result[attrName] = result[attrName] || [];\n        result[attrName].push(element);\n      }\n    }\n\n    return result;\n  }\n\n  getOldCharacterData(node:Node):string {\n    var change = this.treeChanges.get(node);\n    if (!change || !change.characterData)\n      throw Error('getOldCharacterData requested on invalid node.');\n\n    return change.characterDataOldValue;\n  }\n\n  getCharacterDataChanged():Node[] {\n    if (!this.treeChanges.anyCharacterDataChanged)\n      return []; // No characterData mutations occurred.\n\n    var nodes = this.treeChanges.keys();\n    var result:Node[] = [];\n    for (var i = 0; i < nodes.length; i++) {\n      var target = nodes[i];\n      if (Movement.STAYED_IN !== this.treeChanges.reachabilityChange(target))\n        continue;\n\n      var change = this.treeChanges.get(target);\n      if (!change.characterData ||\n          target.textContent == change.characterDataOldValue)\n        continue\n\n      result.push(target);\n    }\n\n    return result;\n  }\n\n  computeMatchabilityChange(selector:Selector, el:Element):Movement {\n    if (!this.matchCache)\n      this.matchCache = [];\n    if (!this.matchCache[selector.uid])\n      this.matchCache[selector.uid] = new NodeMap<Movement>();\n\n    var cache = this.matchCache[selector.uid];\n    var result = cache.get(el);\n    if (result === undefined) {\n      result = selector.matchabilityChange(el, this.treeChanges.get(el));\n      cache.set(el, result);\n    }\n    return result;\n  }\n\n  matchabilityChange(node:Node): Movement {\n    // TODO(rafaelw): Include PI, CDATA?\n    // Only include text nodes.\n    if (this.characterDataOnly) {\n      switch (node.nodeType) {\n        case Node.COMMENT_NODE:\n        case Node.TEXT_NODE:\n          return Movement.STAYED_IN;\n        default:\n          return Movement.STAYED_OUT;\n      }\n    }\n\n    // No element filter. Include all nodes.\n    if (!this.selectors)\n      return Movement.STAYED_IN;\n\n    // Element filter. Exclude non-elements.\n    if (node.nodeType !== Node.ELEMENT_NODE)\n      return Movement.STAYED_OUT;\n\n    var el = <Element>node;\n\n    var matchChanges = this.selectors.map((selector:Selector) => {\n      return this.computeMatchabilityChange(selector, el);\n    });\n\n    var accum:Movement = Movement.STAYED_OUT;\n    var i = 0;\n\n    while (accum !== Movement.STAYED_IN && i < matchChanges.length) {\n      switch(matchChanges[i]) {\n        case Movement.STAYED_IN:\n          accum = Movement.STAYED_IN;\n          break;\n        case Movement.ENTERED:\n          if (accum === Movement.EXITED)\n            accum = Movement.STAYED_IN;\n          else\n            accum = Movement.ENTERED;\n          break;\n        case Movement.EXITED:\n          if (accum === Movement.ENTERED)\n            accum = Movement.STAYED_IN;\n          else\n            accum = Movement.EXITED;\n          break;\n      }\n\n      i++;\n    }\n\n    return accum;\n  }\n\n  getChildlistChange(el:Element):ChildListChange {\n    var change = this.childListChangeMap.get(el);\n    if (!change) {\n      change = new ChildListChange();\n      this.childListChangeMap.set(el, change);\n    }\n\n    return change;\n  }\n\n  processChildlistChanges() {\n    if (this.childListChangeMap)\n      return;\n\n    this.childListChangeMap = new NodeMap<ChildListChange>();\n\n    for (var i = 0; i < this.mutations.length; i++) {\n      var mutation = this.mutations[i];\n      if (mutation.type != 'childList')\n        continue;\n\n      if (this.treeChanges.reachabilityChange(mutation.target) !== Movement.STAYED_IN &&\n          !this.calcOldPreviousSibling)\n        continue;\n\n      var change = this.getChildlistChange(<Element>mutation.target);\n\n      var oldPrevious = mutation.previousSibling;\n\n      const recordOldPrevious = (node:Node, previous:Node) => {\n        if (!node ||\n            change.oldPrevious.has(node) ||\n            change.added.has(node) ||\n            change.maybeMoved.has(node))\n          return;\n\n        if (previous &&\n            (change.added.has(previous) ||\n             change.maybeMoved.has(previous)))\n          return;\n\n        change.oldPrevious.set(node, previous);\n      }\n\n      for (var j = 0; j < mutation.removedNodes.length; j++) {\n        var node = mutation.removedNodes[j];\n        recordOldPrevious(node, oldPrevious);\n\n        if (change.added.has(node)) {\n          change.added.delete(node);\n        } else {\n          change.removed.set(node, true);\n          change.maybeMoved.delete(node);\n        }\n\n        oldPrevious = node;\n      }\n\n      recordOldPrevious(mutation.nextSibling, oldPrevious);\n\n      for (var j = 0; j < mutation.addedNodes.length; j++) {\n        var node = mutation.addedNodes[j];\n        if (change.removed.has(node)) {\n          change.removed.delete(node);\n          change.maybeMoved.set(node, true);\n        } else {\n          change.added.set(node, true);\n        }\n      }\n    }\n  }\n\n  wasReordered(node:Node) {\n    if (!this.treeChanges.anyParentsChanged)\n      return false;\n\n    this.processChildlistChanges();\n\n    var parentNode = node.parentNode as Node;\n    var nodeChange = this.treeChanges.get(node);\n    if (nodeChange && nodeChange.oldParentNode)\n      parentNode = nodeChange.oldParentNode;\n\n    var change = this.childListChangeMap.get(parentNode);\n    if (!change)\n      return false;\n\n    if (change.moved)\n      return change.moved.get(node);\n\n    change.moved = new NodeMap<boolean>();\n    var pendingMoveDecision = new NodeMap<boolean>();\n\n    function isMoved(node:Node) {\n      if (!node)\n        return false;\n      if (!change.maybeMoved.has(node))\n        return false;\n\n      var didMove = change.moved.get(node);\n      if (didMove !== undefined)\n        return didMove;\n\n      if (pendingMoveDecision.has(node)) {\n        didMove = true;\n      } else {\n        pendingMoveDecision.set(node, true);\n        didMove = getPrevious(node) !== getOldPrevious(node);\n      }\n\n      if (pendingMoveDecision.has(node)) {\n        pendingMoveDecision.delete(node);\n        change.moved.set(node, didMove);\n      } else {\n        didMove = change.moved.get(node);\n      }\n\n      return didMove;\n    }\n\n    var oldPreviousCache = new NodeMap<Node>();\n    function getOldPrevious(node:Node):Node {\n      var oldPrevious = oldPreviousCache.get(node);\n      if (oldPrevious !== undefined)\n        return oldPrevious;\n\n      oldPrevious = change.oldPrevious.get(node);\n      while (oldPrevious &&\n             (change.removed.has(oldPrevious) || isMoved(oldPrevious))) {\n        oldPrevious = getOldPrevious(oldPrevious);\n      }\n\n      if (oldPrevious === undefined)\n        oldPrevious = node.previousSibling;\n      oldPreviousCache.set(node, oldPrevious);\n\n      return oldPrevious;\n    }\n\n    var previousCache = new NodeMap<Node>();\n    function getPrevious(node:Node):Node {\n      if (previousCache.has(node))\n        return previousCache.get(node);\n\n      var previous = node.previousSibling;\n      while (previous && (change.added.has(previous) || isMoved(previous)))\n        previous = previous.previousSibling;\n\n      previousCache.set(node, previous);\n      return previous;\n    }\n\n    change.maybeMoved.keys().forEach(isMoved);\n    return change.moved.get(node);\n  }\n}\n\n class Summary {\n  public added:Node[];\n  public removed:Node[];\n  public reparented:Node[];\n  public reordered:Node[];\n  public valueChanged:Node[];\n  public attributeChanged:StringMap<Element[]>;\n  public characterDataChanged:Node[];\n\n  constructor(private projection:MutationProjection, query:Query) {\n    this.added = [];\n    this.removed = [];\n    this.reparented = query.all || query.element || query.characterData ? [] : undefined;\n    this.reordered = query.all ? [] : undefined;\n\n    projection.getChanged(this, query.elementFilter, query.characterData);\n\n    if (query.all || query.attribute || query.attributeList) {\n      var filter = query.attribute ? [ query.attribute ] : query.attributeList;\n      var attributeChanged = projection.attributeChangedNodes(filter);\n\n      if (query.attribute) {\n        this.valueChanged = attributeChanged[query.attribute] || [];\n      } else {\n        this.attributeChanged = attributeChanged;\n        if (query.attributeList) {\n          query.attributeList.forEach((attrName) => {\n            if (!this.attributeChanged.hasOwnProperty(attrName))\n              this.attributeChanged[attrName] = [];\n          });\n        }\n      }\n    }\n\n    if (query.all || query.characterData) {\n      var characterDataChanged = projection.getCharacterDataChanged()\n\n      if (query.characterData)\n        this.valueChanged = characterDataChanged;\n      else\n        this.characterDataChanged = characterDataChanged;\n    }\n\n    if (this.reordered)\n      this.getOldPreviousSibling = projection.getOldPreviousSibling.bind(projection);\n  }\n\n  getOldParentNode(node:Node):Node {\n    return this.projection.getOldParentNode(node);\n  }\n\n  getOldAttribute(node:Node, name: string):string {\n    return this.projection.getOldAttribute(node, name);\n  }\n\n  getOldCharacterData(node:Node):string {\n    return this.projection.getOldCharacterData(node);\n  }\n\n  getOldPreviousSibling(node:Node):Node {\n    return this.projection.getOldPreviousSibling(node);\n  }\n}\n\n// TODO(rafaelw): Allow ':' and '.' as valid name characters.\nvar validNameInitialChar = /[a-zA-Z_]+/;\nvar validNameNonInitialChar = /[a-zA-Z0-9_\\-]+/;\n\n// TODO(rafaelw): Consider allowing backslash in the attrValue.\n// TODO(rafaelw): There's got a to be way to represent this state machine\n// more compactly???\n\nfunction escapeQuotes(value:string):string {\n  return '\"' + value.replace(/\"/, '\\\\\\\"') + '\"';\n}\n\nclass Qualifier {\n  public attrName:string;\n  public attrValue:string;\n  public contains:boolean;\n\n  constructor() {}\n\n  public matches(oldValue:string):boolean {\n    if (oldValue === null)\n      return false;\n\n    if (this.attrValue === undefined)\n      return true;\n\n    if (!this.contains)\n      return this.attrValue == oldValue;\n\n    var tokens = oldValue.split(' ');\n    for (var i = 0; i < tokens.length; i++) {\n      if (this.attrValue === tokens[i])\n        return true;\n    }\n\n    return false;\n  }\n\n  public toString():string {\n    if (this.attrName === 'class' && this.contains)\n      return '.' + this.attrValue;\n\n    if (this.attrName === 'id' && !this.contains)\n      return '#' + this.attrValue;\n\n    if (this.contains)\n      return '[' + this.attrName + '~=' + escapeQuotes(this.attrValue) + ']';\n\n    if ('attrValue' in this)\n      return '[' + this.attrName + '=' + escapeQuotes(this.attrValue) + ']';\n\n    //@ts-ignore\n    return '[' + this.attrName + ']';\n  }\n}\n\nclass Selector {\n  private static nextUid:number = 1;\n  private static matchesSelector:string = (function(){\n    var element = document.createElement('div');\n    if (typeof element['webkitMatchesSelector'] === 'function')\n      return 'webkitMatchesSelector';\n    if (typeof element['mozMatchesSelector'] === 'function')\n      return 'mozMatchesSelector';\n    if (typeof element['msMatchesSelector'] === 'function')\n      return 'msMatchesSelector';\n\n    return 'matchesSelector';\n  })();\n\n  public tagName:string;\n  public qualifiers:Qualifier[];\n  public uid:number;\n\n  private get caseInsensitiveTagName():string {\n    return this.tagName.toUpperCase();\n  }\n\n  get selectorString() {\n    return this.tagName + this.qualifiers.join('');\n  }\n\n  constructor() {\n    this.uid = Selector.nextUid++;\n    this.qualifiers = [];\n  }\n\n  private isMatching(el:Element):boolean {\n    return el[Selector.matchesSelector](this.selectorString);\n  }\n\n  private wasMatching(el:Element, change:NodeChange, isMatching:boolean):boolean {\n    if (!change || !change.attributes)\n      return isMatching;\n\n    var tagName = change.isCaseInsensitive ? this.caseInsensitiveTagName : this.tagName;\n    if (tagName !== '*' && tagName !== el.tagName)\n      return false;\n\n    var attributeOldValues:string[] = [];\n    var anyChanged = false;\n    for (var i = 0; i < this.qualifiers.length; i++) {\n      var qualifier = this.qualifiers[i];\n      var oldValue = change.getAttributeOldValue(qualifier.attrName);\n      attributeOldValues.push(oldValue);\n      anyChanged = anyChanged || (oldValue !== undefined);\n    }\n\n    if (!anyChanged)\n      return isMatching;\n\n    for (var i = 0; i < this.qualifiers.length; i++) {\n      var qualifier = this.qualifiers[i];\n      var oldValue = attributeOldValues[i];\n      if (oldValue === undefined)\n        oldValue = el.getAttribute(qualifier.attrName);\n      if (!qualifier.matches(oldValue))\n        return false;\n    }\n\n    return true;\n  }\n\n  public matchabilityChange(el:Element, change:NodeChange):Movement {\n    var isMatching = this.isMatching(el);\n    if (isMatching)\n      return this.wasMatching(el, change, isMatching) ? Movement.STAYED_IN : Movement.ENTERED;\n    else\n      return this.wasMatching(el, change, isMatching) ? Movement.EXITED : Movement.STAYED_OUT;\n  }\n\n  public static parseSelectors(input:string):Selector[] {\n    var selectors:Selector[] = [];\n    var currentSelector:Selector;\n    var currentQualifier:Qualifier;\n\n    function newSelector() {\n      if (currentSelector) {\n        if (currentQualifier) {\n          currentSelector.qualifiers.push(currentQualifier);\n          currentQualifier = undefined;\n        }\n\n        selectors.push(currentSelector);\n      }\n      currentSelector = new Selector();\n    }\n\n    function newQualifier() {\n      if (currentQualifier)\n        currentSelector.qualifiers.push(currentQualifier);\n\n      currentQualifier = new Qualifier();\n    }\n\n    var WHITESPACE = /\\s/;\n    var valueQuoteChar:string;\n    var SYNTAX_ERROR = 'Invalid or unsupported selector syntax.';\n\n    var SELECTOR = 1;\n    var TAG_NAME = 2;\n    var QUALIFIER = 3;\n    var QUALIFIER_NAME_FIRST_CHAR = 4;\n    var QUALIFIER_NAME = 5;\n    var ATTR_NAME_FIRST_CHAR = 6;\n    var ATTR_NAME = 7;\n    var EQUIV_OR_ATTR_QUAL_END = 8;\n    var EQUAL = 9;\n    var ATTR_QUAL_END = 10;\n    var VALUE_FIRST_CHAR = 11;\n    var VALUE = 12;\n    var QUOTED_VALUE = 13;\n    var SELECTOR_SEPARATOR = 14;\n\n    var state = SELECTOR;\n    var i = 0;\n    while (i < input.length) {\n      var c = input[i++];\n\n      switch (state) {\n        case SELECTOR:\n          if (c.match(validNameInitialChar)) {\n            newSelector();\n            currentSelector.tagName = c;\n            state = TAG_NAME;\n            break;\n          }\n\n          if (c == '*') {\n            newSelector();\n            currentSelector.tagName = '*';\n            state = QUALIFIER;\n            break;\n          }\n\n          if (c == '.') {\n            newSelector();\n            newQualifier();\n            currentSelector.tagName = '*';\n            currentQualifier.attrName = 'class';\n            currentQualifier.contains = true;\n            state = QUALIFIER_NAME_FIRST_CHAR;\n            break;\n          }\n          if (c == '#') {\n            newSelector();\n            newQualifier();\n            currentSelector.tagName = '*';\n            currentQualifier.attrName = 'id';\n            state = QUALIFIER_NAME_FIRST_CHAR;\n            break;\n          }\n          if (c == '[') {\n            newSelector();\n            newQualifier();\n            currentSelector.tagName = '*';\n            currentQualifier.attrName = '';\n            state = ATTR_NAME_FIRST_CHAR;\n            break;\n          }\n\n          if (c.match(WHITESPACE))\n            break;\n\n          throw Error(SYNTAX_ERROR);\n\n        case TAG_NAME:\n          if (c.match(validNameNonInitialChar)) {\n            currentSelector.tagName += c;\n            break;\n          }\n\n          if (c == '.') {\n            newQualifier();\n            currentQualifier.attrName = 'class';\n            currentQualifier.contains = true;\n            state = QUALIFIER_NAME_FIRST_CHAR;\n            break;\n          }\n          if (c == '#') {\n            newQualifier();\n            currentQualifier.attrName = 'id';\n            state = QUALIFIER_NAME_FIRST_CHAR;\n            break;\n          }\n          if (c == '[') {\n            newQualifier();\n            currentQualifier.attrName = '';\n            state = ATTR_NAME_FIRST_CHAR;\n            break;\n          }\n\n          if (c.match(WHITESPACE)) {\n            state = SELECTOR_SEPARATOR;\n            break;\n          }\n\n          if (c == ',') {\n            state = SELECTOR;\n            break;\n          }\n\n          throw Error(SYNTAX_ERROR);\n\n        case QUALIFIER:\n          if (c == '.') {\n            newQualifier();\n            currentQualifier.attrName = 'class';\n            currentQualifier.contains = true;\n            state = QUALIFIER_NAME_FIRST_CHAR;\n            break;\n          }\n          if (c == '#') {\n            newQualifier();\n            currentQualifier.attrName = 'id';\n            state = QUALIFIER_NAME_FIRST_CHAR;\n            break;\n          }\n          if (c == '[') {\n            newQualifier();\n            currentQualifier.attrName = '';\n            state = ATTR_NAME_FIRST_CHAR;\n            break;\n          }\n\n          if (c.match(WHITESPACE)) {\n            state = SELECTOR_SEPARATOR;\n            break;\n          }\n\n          if (c == ',') {\n            state = SELECTOR;\n            break;\n          }\n\n          throw Error(SYNTAX_ERROR);\n\n        case QUALIFIER_NAME_FIRST_CHAR:\n          if (c.match(validNameInitialChar)) {\n            currentQualifier.attrValue = c;\n            state = QUALIFIER_NAME;\n            break;\n          }\n\n          throw Error(SYNTAX_ERROR);\n\n        case QUALIFIER_NAME:\n          if (c.match(validNameNonInitialChar)) {\n            currentQualifier.attrValue += c;\n            break;\n          }\n\n          if (c == '.') {\n            newQualifier();\n            currentQualifier.attrName = 'class';\n            currentQualifier.contains = true;\n            state = QUALIFIER_NAME_FIRST_CHAR;\n            break;\n          }\n          if (c == '#') {\n            newQualifier();\n            currentQualifier.attrName = 'id';\n            state = QUALIFIER_NAME_FIRST_CHAR;\n            break;\n          }\n          if (c == '[') {\n            newQualifier();\n            state = ATTR_NAME_FIRST_CHAR;\n            break;\n          }\n\n          if (c.match(WHITESPACE)) {\n            state = SELECTOR_SEPARATOR;\n            break;\n          }\n          if (c == ',') {\n            state = SELECTOR;\n            break\n          }\n\n          throw Error(SYNTAX_ERROR);\n\n        case ATTR_NAME_FIRST_CHAR:\n          if (c.match(validNameInitialChar)) {\n            currentQualifier.attrName = c;\n            state = ATTR_NAME;\n            break;\n          }\n\n          if (c.match(WHITESPACE))\n            break;\n\n          throw Error(SYNTAX_ERROR);\n\n        case ATTR_NAME:\n          if (c.match(validNameNonInitialChar)) {\n            currentQualifier.attrName += c;\n            break;\n          }\n\n          if (c.match(WHITESPACE)) {\n            state = EQUIV_OR_ATTR_QUAL_END;\n            break;\n          }\n\n          if (c == '~') {\n            currentQualifier.contains = true;\n            state = EQUAL;\n            break;\n          }\n\n          if (c == '=') {\n            currentQualifier.attrValue = '';\n            state = VALUE_FIRST_CHAR;\n            break;\n          }\n\n          if (c == ']') {\n            state = QUALIFIER;\n            break;\n          }\n\n          throw Error(SYNTAX_ERROR);\n\n        case EQUIV_OR_ATTR_QUAL_END:\n          if (c == '~') {\n            currentQualifier.contains = true;\n            state = EQUAL;\n            break;\n          }\n\n          if (c == '=') {\n            currentQualifier.attrValue = '';\n            state = VALUE_FIRST_CHAR;\n            break;\n          }\n\n          if (c == ']') {\n            state = QUALIFIER;\n            break;\n          }\n\n          if (c.match(WHITESPACE))\n            break;\n\n          throw Error(SYNTAX_ERROR);\n\n        case EQUAL:\n          if (c == '=') {\n            currentQualifier.attrValue = '';\n            state = VALUE_FIRST_CHAR\n            break;\n          }\n\n          throw Error(SYNTAX_ERROR);\n\n        case ATTR_QUAL_END:\n          if (c == ']') {\n            state = QUALIFIER;\n            break;\n          }\n\n          if (c.match(WHITESPACE))\n            break;\n\n          throw Error(SYNTAX_ERROR);\n\n        case VALUE_FIRST_CHAR:\n          if (c.match(WHITESPACE))\n            break;\n\n          if (c == '\"' || c == \"'\") {\n            valueQuoteChar = c;\n            state = QUOTED_VALUE;\n            break;\n          }\n\n          currentQualifier.attrValue += c;\n          state = VALUE;\n          break;\n\n        case VALUE:\n          if (c.match(WHITESPACE)) {\n            state = ATTR_QUAL_END;\n            break;\n          }\n          if (c == ']') {\n            state = QUALIFIER;\n            break;\n          }\n          if (c == \"'\" || c == '\"')\n            throw Error(SYNTAX_ERROR);\n\n          currentQualifier.attrValue += c;\n          break;\n\n        case QUOTED_VALUE:\n          if (c == valueQuoteChar) {\n            state = ATTR_QUAL_END;\n            break;\n          }\n\n          currentQualifier.attrValue += c;\n          break;\n\n        case SELECTOR_SEPARATOR:\n          if (c.match(WHITESPACE))\n            break;\n\n          if (c == ',') {\n            state = SELECTOR;\n            break\n          }\n\n          throw Error(SYNTAX_ERROR);\n      }\n    }\n\n    switch (state) {\n      case SELECTOR:\n      case TAG_NAME:\n      case QUALIFIER:\n      case QUALIFIER_NAME:\n      case SELECTOR_SEPARATOR:\n        // Valid end states.\n        newSelector();\n        break;\n      default:\n        throw Error(SYNTAX_ERROR);\n    }\n\n    if (!selectors.length)\n      throw Error(SYNTAX_ERROR);\n\n    return selectors;\n  }\n}\n\nvar attributeFilterPattern = /^([a-zA-Z:_]+[a-zA-Z0-9_\\-:\\.]*)$/;\n\nfunction validateAttribute(attribute:string) {\n  if (typeof attribute != 'string')\n    throw Error('Invalid request opion. attribute must be a non-zero length string.');\n\n  attribute = attribute.trim();\n\n  if (!attribute)\n    throw Error('Invalid request opion. attribute must be a non-zero length string.');\n\n\n  if (!attribute.match(attributeFilterPattern))\n    throw Error('Invalid request option. invalid attribute name: ' + attribute);\n\n  return attribute;\n}\n\nfunction validateElementAttributes(attribs:string):string[] {\n  if (!attribs.trim().length)\n    throw Error('Invalid request option: elementAttributes must contain at least one attribute.');\n\n  var lowerAttributes = {};\n  var attributes = {};\n\n  var tokens = attribs.split(/\\s+/);\n  for (var i = 0; i < tokens.length; i++) {\n    var name = tokens[i];\n    if (!name)\n      continue;\n\n    var name = validateAttribute(name);\n    var nameLower = name.toLowerCase();\n    if (lowerAttributes[nameLower])\n      throw Error('Invalid request option: observing multiple case variations of the same attribute is not supported.');\n\n    attributes[name] = true;\n    lowerAttributes[nameLower] = true;\n  }\n\n  return Object.keys(attributes);\n}\n\n\n\nfunction elementFilterAttributes(selectors:Selector[]):string[] {\n  var attributes:StringMap<boolean> = {};\n\n  selectors.forEach((selector) => {\n    selector.qualifiers.forEach((qualifier) => {\n      attributes[qualifier.attrName] = true;\n    });\n  });\n\n  return Object.keys(attributes);\n}\n\n interface Query {\n  element?:string;\n  attribute?:string;\n  all?:boolean;\n  characterData?:boolean;\n  elementAttributes?:string;\n  attributeList?:string[];\n  elementFilter?:Selector[];\n}\n\n interface Options {\n  callback:(summaries:Summary[]) => any;\n  queries: Query[];\n  rootNode?:Node;\n  oldPreviousSibling?:boolean;\n  observeOwnChanges?:boolean;\n}\n\n class MutationSummary {\n\n  public static NodeMap = NodeMap; // exposed for use in TreeMirror.\n  public static parseElementFilter = Selector.parseSelectors; // exposed for testing.\n\n  public static createQueryValidator:(root:Node, query:Query)=>any;\n  private connected:boolean;\n  private options:Options;\n  private observer:MutationObserver;\n  private observerOptions:MutationObserverInit;\n  private root:Node;\n  private callback:(summaries:Summary[])=>any;\n  private elementFilter:Selector[];\n  private calcReordered:boolean;\n  private queryValidators:any[];\n\n  private static optionKeys:StringMap<boolean> = {\n    'callback': true, // required\n    'queries': true,  // required\n    'rootNode': true,\n    'oldPreviousSibling': true,\n    'observeOwnChanges': true\n  };\n\n  private static createObserverOptions(queries:Query[]):MutationObserverInit {\n    var observerOptions:MutationObserverInit = {\n      childList: true,\n      subtree: true\n    };\n\n    var attributeFilter:StringMap<boolean>;\n    function observeAttributes(attributes?:string[]) {\n      if (observerOptions.attributes && !attributeFilter)\n        return; // already observing all.\n\n      observerOptions.attributes = true;\n      observerOptions.attributeOldValue = true;\n\n      if (!attributes) {\n        // observe all.\n        attributeFilter = undefined;\n        return;\n      }\n\n      // add to observed.\n      attributeFilter = attributeFilter || {};\n      attributes.forEach((attribute) => {\n        attributeFilter[attribute] = true;\n        attributeFilter[attribute.toLowerCase()] = true;\n      });\n    }\n\n    queries.forEach((query) => {\n      if (query.characterData) {\n        observerOptions.characterData = true;\n        observerOptions.characterDataOldValue = true;\n        return;\n      }\n\n      if (query.all) {\n        observeAttributes();\n        observerOptions.characterData = true;\n        observerOptions.characterDataOldValue = true;\n        return;\n      }\n\n      if (query.attribute) {\n        observeAttributes([query.attribute.trim()]);\n        return;\n      }\n\n      var attributes = elementFilterAttributes(query.elementFilter).concat(query.attributeList || []);\n      if (attributes.length)\n        observeAttributes(attributes);\n    });\n\n    if (attributeFilter)\n      observerOptions.attributeFilter = Object.keys(attributeFilter);\n\n    return observerOptions;\n  }\n\n  private static validateOptions(options:Options):Options {\n    for (var prop in options) {\n      if (!(prop in MutationSummary.optionKeys))\n        throw Error('Invalid option: ' + prop);\n    }\n\n    if (typeof options.callback !== 'function')\n      throw Error('Invalid options: callback is required and must be a function');\n\n    if (!options.queries || !options.queries.length)\n      throw Error('Invalid options: queries must contain at least one query request object.');\n\n    var opts:Options = {\n      callback: options.callback,\n      rootNode: options.rootNode || document,\n      observeOwnChanges: !!options.observeOwnChanges,\n      oldPreviousSibling: !!options.oldPreviousSibling,\n      queries: []\n    };\n\n    for (var i = 0; i < options.queries.length; i++) {\n      var request = options.queries[i];\n\n      // all\n      if (request.all) {\n        if (Object.keys(request).length > 1)\n          throw Error('Invalid request option. all has no options.');\n\n        opts.queries.push({all: true});\n        continue;\n      }\n\n      // attribute\n      if ('attribute' in request) {\n        var query:Query = {\n          attribute: validateAttribute(request.attribute)\n        };\n\n        query.elementFilter = Selector.parseSelectors('*[' + query.attribute + ']');\n\n        if (Object.keys(request).length > 1)\n          throw Error('Invalid request option. attribute has no options.');\n\n        opts.queries.push(query);\n        continue;\n      }\n\n      // element\n      if ('element' in request) {\n        var requestOptionCount = Object.keys(request).length;\n        var query:Query = {\n          element: request.element,\n          elementFilter: Selector.parseSelectors(request.element)\n        };\n\n        if (request.hasOwnProperty('elementAttributes')) {\n          query.attributeList = validateElementAttributes(request.elementAttributes);\n          requestOptionCount--;\n        }\n\n        if (requestOptionCount > 1)\n          throw Error('Invalid request option. element only allows elementAttributes option.');\n\n        opts.queries.push(query);\n        continue;\n      }\n\n      // characterData\n      if (request.characterData) {\n        if (Object.keys(request).length > 1)\n          throw Error('Invalid request option. characterData has no options.');\n\n        opts.queries.push({ characterData: true });\n        continue;\n      }\n\n      throw Error('Invalid request option. Unknown query request.');\n    }\n\n    return opts;\n  }\n\n  private createSummaries(mutations:MutationRecord[]):Summary[] {\n    if (!mutations || !mutations.length)\n      return [];\n\n    var projection = new MutationProjection(this.root, mutations, this.elementFilter, this.calcReordered, this.options.oldPreviousSibling);\n\n    var summaries:Summary[] = [];\n    for (var i = 0; i < this.options.queries.length; i++) {\n      summaries.push(new Summary(projection, this.options.queries[i]));\n    }\n\n    return summaries;\n  }\n\n  private checkpointQueryValidators() {\n    this.queryValidators.forEach((validator) => {\n      if (validator)\n        validator.recordPreviousState();\n    });\n  }\n\n  private runQueryValidators(summaries:Summary[]) {\n    this.queryValidators.forEach((validator, index) => {\n      if (validator)\n        validator.validate(summaries[index]);\n    });\n  }\n\n  private changesToReport(summaries:Summary[]):boolean {\n    return summaries.some((summary) => {\n      var summaryProps =  ['added', 'removed', 'reordered', 'reparented',\n        'valueChanged', 'characterDataChanged'];\n      if (summaryProps.some(function(prop) { return summary[prop] && summary[prop].length; }))\n        return true;\n\n      if (summary.attributeChanged) {\n        var attrNames = Object.keys(summary.attributeChanged);\n        var attrsChanged = attrNames.some((attrName) => {\n          return !!summary.attributeChanged[attrName].length\n        });\n        if (attrsChanged)\n          return true;\n      }\n      return false;\n    });\n  }\n\n  constructor(opts:Options) {\n    this.connected = false;\n    this.options = MutationSummary.validateOptions(opts);\n    this.observerOptions = MutationSummary.createObserverOptions(this.options.queries);\n    this.root = this.options.rootNode;\n    this.callback = this.options.callback;\n\n    this.elementFilter = Array.prototype.concat.apply([], this.options.queries.map((query) => {\n      return query.elementFilter ? query.elementFilter : [];\n    }));\n    if (!this.elementFilter.length)\n      this.elementFilter = undefined;\n\n    this.calcReordered = this.options.queries.some((query) => {\n      return query.all;\n    });\n\n    this.queryValidators = []; // TODO(rafaelw): Shouldn't always define this.\n    if (MutationSummary.createQueryValidator) {\n      this.queryValidators = this.options.queries.map((query) => {\n        return MutationSummary.createQueryValidator(this.root, query);\n      });\n    }\n\n    this.observer = new MutationObserverCtor((mutations:MutationRecord[]) => {\n      this.observerCallback(mutations);\n    });\n\n    this.reconnect();\n  }\n\n  private observerCallback(mutations:MutationRecord[]) {\n    if (!this.options.observeOwnChanges)\n      this.observer.disconnect();\n\n    var summaries = this.createSummaries(mutations);\n    this.runQueryValidators(summaries);\n\n    if (this.options.observeOwnChanges)\n      this.checkpointQueryValidators();\n\n    if (this.changesToReport(summaries))\n      this.callback(summaries);\n\n    // disconnect() may have been called during the callback.\n    if (!this.options.observeOwnChanges && this.connected) {\n      this.checkpointQueryValidators();\n      this.observer.observe(this.root, this.observerOptions);\n    }\n  }\n\n  reconnect() {\n    if (this.connected)\n      throw Error('Already connected');\n\n    this.observer.observe(this.root, this.observerOptions);\n    this.connected = true;\n    this.checkpointQueryValidators();\n  }\n\n  takeSummaries():Summary[] {\n    if (!this.connected)\n      throw Error('Not connected');\n\n    var summaries = this.createSummaries(this.observer.takeRecords());\n    return this.changesToReport(summaries) ? summaries : undefined;\n  }\n\n  disconnect():Summary[] {\n    var summaries = this.takeSummaries();\n    this.observer.disconnect();\n    this.connected = false;\n    return summaries;\n  }\n}\n\n"]}